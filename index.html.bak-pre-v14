<!DOCTYPE html>
<html lang="en"><head>
<meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>Zeke Mission Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:opsz,wght@9..40,300;9..40,400;9..40,500;9..40,600;9..40,700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root{--bg:#0c0e14;--surface:#14171f;--surface2:#1a1e28;--border:#232838;--border2:#2d3348;--text:#e2e4ea;--text2:#a0a5b8;--text3:#636a82;--accent:#4dd8c0;--accent2:#3bbfa9;--ok:#34d399;--warn:#f87171;--orange:#fbbf24;--blue:#60a5fa;--purple:#a78bfa;--r:10px;}
*,*::before,*::after{margin:0;padding:0;box-sizing:border-box;}
html,body{height:100%;overflow:hidden;}
body{font-family:'DM Sans',-apple-system,sans-serif;background:var(--bg);color:var(--text);font-size:13px;line-height:1.5;-webkit-font-smoothing:antialiased;display:flex;flex-direction:column;}
.topbar{flex-shrink:0;display:flex;align-items:center;gap:16px;padding:11px 20px 9px;border-bottom:1px solid var(--border);background:var(--bg);}
.title{font-size:1.1em;font-weight:700;letter-spacing:-0.3px;}.title span{color:var(--accent);}
.badge{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;letter-spacing:0.5px;}
.badge.ok{background:rgba(52,211,153,.12);color:var(--ok);border:1px solid rgba(52,211,153,.2);}
.badge.warn{background:rgba(248,113,113,.12);color:var(--warn);border:1px solid rgba(248,113,113,.2);}
.badge.issues{background:rgba(251,191,36,.12);color:var(--orange);border:1px solid rgba(251,191,36,.2);}
.topbar-ts{font-family:'JetBrains Mono',monospace;font-size:11px;color:var(--text3);margin-left:auto;}
.main{flex:1;overflow-y:auto;overflow-x:hidden;padding:12px 20px 20px;}
.statbar{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin-bottom:12px;}
.stat{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:11px 14px;text-align:center;}
.stat .val{font-family:'JetBrains Mono',monospace;font-size:1.5em;font-weight:700;line-height:1.1;}
.stat .lbl{font-size:10px;font-weight:600;color:var(--text3);text-transform:uppercase;letter-spacing:1.1px;margin-top:2px;}
.stat .sub{font-size:11px;color:var(--text3);margin-top:1px;}
.autonomy{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:12px 16px;margin-bottom:12px;}
.autonomy h2{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:10px;}
.layers{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;}
.layer{border-radius:8px;padding:10px 12px;border:1px solid var(--border2);}
.layer.deployed{background:rgba(52,211,153,.06);border-color:rgba(52,211,153,.2);}
.layer.progress{background:rgba(251,191,36,.06);border-color:rgba(251,191,36,.2);}
.layer.planned{background:rgba(99,106,130,.06);}
.layer-num{font-family:'JetBrains Mono',monospace;font-size:10px;font-weight:600;color:var(--text3);margin-bottom:2px;}
.layer-name{font-size:12px;font-weight:600;line-height:1.3;}
.layer.deployed .layer-name{color:var(--ok);}.layer.progress .layer-name{color:var(--orange);}.layer.planned .layer-name{color:var(--text3);}
.layer-badge{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;margin-top:4px;}
.layer.deployed .layer-badge{color:var(--ok);}.layer.progress .layer-badge{color:var(--orange);}.layer.planned .layer-badge{color:var(--text3);}
.layer-desc{font-size:10px;color:var(--text3);margin-top:3px;}
.infra{display:flex;gap:6px;align-items:stretch;margin-bottom:12px;}
.infra-node{flex:1;background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:9px 14px;position:relative;}
.infra-node.wide{flex:1.5;}
.infra-dot{position:absolute;top:8px;right:8px;width:7px;height:7px;border-radius:50%;}
.infra-dot.on{background:var(--ok);box-shadow:0 0 6px rgba(52,211,153,.5);}
.infra-dot.off{background:var(--warn);}
.infra-dot.idle{background:var(--orange);box-shadow:0 0 5px rgba(251,191,36,.4);}
.infra-name{font-weight:600;font-size:12px;}.infra-desc{font-size:11px;color:var(--text3);margin-top:1px;}
.infra-arrow{color:var(--text3);font-size:12px;display:flex;align-items:center;}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.grid3{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:12px;}
.card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:12px 16px;}
.card h2{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:9px;}
.row{display:flex;justify-content:space-between;align-items:baseline;padding:2.5px 0;}
.row .rl{font-size:12px;color:var(--text2);}.row .rv{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:500;}
.c-ok{color:var(--ok);}.c-warn{color:var(--warn);}.c-accent{color:var(--accent);}.c-blue{color:var(--blue);}.c-orange{color:var(--orange);}.c-purple{color:var(--purple);}.c-dim{color:var(--text3);}
.chart{height:58px;display:flex;align-items:flex-end;gap:1px;margin-top:8px;}
.bar{flex:1;min-width:2px;border-radius:2px 2px 0 0;background:var(--accent);}
.bar:hover{opacity:1!important;}
.chart-axis{display:flex;justify-content:space-between;padding-top:4px;font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text3);}
.chart-sub{font-size:11px;color:var(--text3);font-family:'JetBrains Mono',monospace;margin-bottom:2px;}
.topic-row{display:flex;align-items:center;gap:8px;padding:2px 0;}
.topic-name{font-size:11px;color:var(--text2);min-width:130px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.tbg{flex:1;height:5px;background:var(--surface2);border-radius:3px;overflow:hidden;}
.tbf{height:100%;border-radius:3px;background:linear-gradient(90deg,var(--accent2),var(--accent));}
.tc{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text3);min-width:24px;text-align:right;}
.jobs-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--r);padding:12px 16px;margin-bottom:12px;}
.jobs-card h2{font-size:10px;font-weight:700;color:var(--text3);text-transform:uppercase;letter-spacing:1.2px;margin-bottom:8px;}
.cycle-hdr{display:flex;align-items:center;gap:8px;padding:5px 0 2px;border-top:1px solid var(--border);font-family:'JetBrains Mono',monospace;font-size:11px;}
.cycle-hdr:first-child{border-top:none;padding-top:0;}
.c-lbl{color:var(--text2);font-weight:600;}.c-time{color:var(--text3);}.c-grew{margin-left:auto;font-weight:600;color:var(--ok);}
.job-row{display:flex;justify-content:space-between;align-items:center;padding:4px 8px;margin:1px 0;border-radius:5px;font-size:12px;}
.job-row.success{background:rgba(52,211,153,.04);}.job-row.fail{background:rgba(248,113,113,.04);}
.jn{font-weight:500;}.jm{font-size:11px;color:var(--text3);font-family:'JetBrains Mono',monospace;}
.js{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:600;min-width:55px;text-align:right;}
.js.success{color:var(--ok);}.js.fail{color:var(--warn);}
.feed-item{padding:6px 0;border-bottom:1px solid var(--border);font-size:12px;}
.feed-item:last-child{border-bottom:none;}
.feed-topic{color:var(--accent);font-weight:500;}.feed-time{font-family:'JetBrains Mono',monospace;font-size:10px;color:var(--text3);margin-left:6px;}
.feed-finding{color:var(--text2);line-height:1.4;margin-top:2px;}
.footer{flex-shrink:0;text-align:center;padding:7px 0;font-size:11px;color:var(--text3);border-top:1px solid var(--border);background:var(--bg);}
.footer a{color:var(--accent);text-decoration:none;}
.divider{height:1px;background:var(--border);margin:0 0 12px;}
</style></head>
<body>
<div class="topbar">
  <div class="title"><span>⚡</span> Zeke Mission Control</div>
  <div class="badge" id="badge">loading</div>
  <div class="topbar-ts" id="ts">—</div>
</div>
<div class="main">
  <div class="statbar" id="statbar"></div>
  <div class="autonomy"><h2>Recursive Learning Progress</h2><div class="layers" id="layers"></div></div>
  <div class="infra" id="infra"></div>
  <div class="grid2" id="charts"></div>
  <div class="grid3" id="grid3"></div>
  <div class="jobs-card" id="jobs"><h2>Recent Cycles</h2></div>
  <div class="card" id="research"><h2>Latest Research</h2></div>
</div>
<div class="footer">Mission Control v13 · 30s refresh · <a href="diagnostic.json">diagnostic</a> · <a href="daily-snapshots.jsonl">snapshots</a></div>

<script>
const $=s=>document.querySelector(s);
const fmt=n=>n!=null?n.toLocaleString():'—';
const dur=s=>{const n=parseFloat(s);return isNaN(n)?'—':n>=60?(n/60).toFixed(1)+'m':Math.round(n)+'s';};
function Row(l,v,c){return `<div class="row"><span class="rl">${l}</span><span class="rv ${c||''}">${v}</span></div>`;}
async function J(u){try{const r=await fetch(u+'?t='+Date.now());return r.ok?r.json():null}catch{return null}}
async function JL(u){try{const r=await fetch(u+'?t='+Date.now());if(!r.ok)return[];return(await r.text()).trim().split('\n').filter(l=>l).map(l=>{try{return JSON.parse(l)}catch{return null}}).filter(Boolean)}catch{return[]}}

async function render(){
  const [d,snaps]=await Promise.all([J('diagnostic.json'),JL('daily-snapshots.jsonl')]);
  if(!d){$('#ts').textContent='Cannot load data';return;}
  const a=d.activity||{},f=d.feed||{},sp=d.spark||{},sc=d.scheduler||{},gw=d.gateway||{},h=d.health||{};

  // Header
  $('#ts').textContent=(d.timestamp_local||'').replace(' ET','')+' ET';
  const hs=h.status||'?';
  const b=$('#badge');
  if(hs==='HEALTHY'){b.textContent='● Healthy';b.className='badge ok';}
  else if(hs==='ISSUES_FOUND'){b.textContent='⚠ '+(h.issue_count||'?')+' Issues';b.className='badge issues';}
  else{b.textContent='● '+hs;b.className='badge warn';}

  // Stats
  const jt=a.jobs_today||d.today?.jobs_run||0;
  const st=a.success_today||d.today?.success||0;
  const ft=(a.fail_today||d.today?.fail||0)+(a.timeout_today||d.today?.timeout||0);
  const fg=a.feed_growth_today||d.today?.feed_growth||0;
  const fl=f.total_lines||0;
  const cc=a.cycle_count||(d.cycles||[]).length||0;
  const sr=jt>0?Math.round(st/jt*100):0;
  const cost=d.cost||{};
  const cv=cost.is_zero_cost?'$0.00':'$'+(cost.estimated_cost_today||0).toFixed(2);
  $('#statbar').innerHTML=`
    <div class="stat"><div class="val c-accent">${fmt(fl)}</div><div class="lbl">Feed Entries</div><div class="sub">+${fg} today</div></div>
    <div class="stat"><div class="val c-blue">${jt}</div><div class="lbl">Jobs Today</div><div class="sub">${sr}% success</div></div>
    <div class="stat"><div class="val c-purple">${cc}</div><div class="lbl">Cycles Run</div><div class="sub">since restart</div></div>
    <div class="stat"><div class="val" style="color:${ft>5?'var(--warn)':ft>0?'var(--orange)':'var(--ok)'}">${ft}</div><div class="lbl">Failed</div><div class="sub">${a.timeout_today||0} timeouts</div></div>
    <div class="stat"><div class="val c-ok">${cv}</div><div class="lbl">API Cost</div><div class="sub">$2/day cap</div></div>`;

  // Autonomy layers
  const auto=d.automation||{};
  const ld=[
    {k:'layer1',name:'Execution',desc:'Scheduler + jobs'},
    {k:'layer2',name:'Oversight',desc:'Self-repair + health'},
    {k:'layer3',name:'Intelligence',desc:'RAG + synthesis'},
    {k:'layer4',name:'Recursive Learning',desc:'Self-directed growth'},
  ];
  $('#layers').innerHTML=ld.map(x=>{
    const raw=auto[x.k]||'';
    const dep=raw.includes('DEPLOYED'),prog=raw.includes('IN PROGRESS');
    const cls=dep?'deployed':prog?'progress':'planned';
    const badge=dep?'✓ Deployed':prog?'⟳ In Progress':'◌ Planned';
    return `<div class="layer ${cls}"><div class="layer-num">${x.k.replace('layer','L')}</div><div class="layer-name">${x.name}</div><div class="layer-badge">${badge}</div><div class="layer-desc">${x.desc}</div></div>`;
  }).join('');

  // Infra
  const spOn=sp.online===true,spInfer=sp.inference_active;
  const models=(sp.models_loaded||[]).map(m=>m.replace(':latest','').replace('-32k',''));
  const kg=d.kg_stats||{};
  const kgN=(kg.entities||0)+(kg.relations||0);
  const topics=f.topic_distribution||{};
  const topicCount=Object.keys(topics).length;
  $('#infra').innerHTML=`
    <div class="infra-node"><div class="infra-dot ${sc.running?'on':'off'}"></div><div class="infra-name">Scheduler</div><div class="infra-desc">PID ${sc.pid||'—'} · ${sc.uptime_minutes||0}m up</div></div>
    <div class="infra-arrow">→</div>
    <div class="infra-node"><div class="infra-dot ${gw.running?'on':'off'}"></div><div class="infra-name">Gateway</div><div class="infra-desc">OpenClaw</div></div>
    <div class="infra-arrow">→</div>
    <div class="infra-node"><div class="infra-dot ${spOn?(spInfer?'on':'idle'):'off'}"></div><div class="infra-name">DGX Spark</div><div class="infra-desc">${models.slice(0,2).join(' · ')||'—'}</div></div>
    <div class="infra-arrow">→</div>
    <div class="infra-node wide"><div class="infra-dot on"></div><div class="infra-name">Knowledge Base</div><div class="infra-desc">${fmt(fl)} entries · ${topicCount} topics · ${kgN} KG nodes · 913+ RAG vectors</div></div>`;

  // Charts
  const fh=d.feed_history||[];
  let todayHtml='',longHtml='';
  if(fh.length>3){
    const vals=fh.map(h2=>typeof h2==='object'?(h2.v||h2.value||0):Number(h2)||0);
    const labs=fh.map(h2=>typeof h2==='object'?(h2.l||''):'');
    const step=Math.max(1,Math.floor(vals.length/70));
    const sv=vals.filter((_,i)=>i%step===0);
    const sl=labs.filter((_,i)=>i%step===0);
    const smn=Math.min(...sv),smx=Math.max(...sv),srng=smx-smn||1;
    const bars=sv.map((v,i)=>{
      const pct=Math.max(((v-smn)/srng)*100,3);
      const op=(.3+.7*(i/sv.length)).toFixed(2);
      return `<div class="bar" style="height:${pct}%;opacity:${op}" title="${sl[i]}: ${v}"></div>`;
    }).join('');
    todayHtml=`<div class="card"><h2>Feed Growth — Today</h2><div class="chart-sub">${smn.toLocaleString()} → ${smx.toLocaleString()} entries</div><div class="chart">${bars}</div><div class="chart-axis"><span>${sl[0]||''}</span><span>${sl[Math.floor(sl.length/2)]||''}</span><span>${sl[sl.length-1]||''}</span></div></div>`;
  }
  if(snaps.length>1){
    const sv=snaps.map(s=>s.feed_total||0);
    const smn=Math.min(...sv),smx=Math.max(...sv),srng=smx-smn||1;
    const step=Math.max(1,Math.floor(snaps.length/80));
    const ss=snaps.filter((_,i)=>i%step===0);
    const bars=ss.map((s,i)=>{
      const v=s.feed_total||0;
      const pct=Math.max(((v-smn)/srng)*100,3);
      const op=(.25+.75*(i/ss.length)).toFixed(2);
      const col=s.event?.includes('clean')?'var(--orange)':'var(--accent)';
      return `<div class="bar" style="height:${pct}%;opacity:${op};background:${col}" title="${s.date} ${s.hour}: ${v}"></div>`;
    }).join('');
    longHtml=`<div class="card"><h2>Cumulative Knowledge — All Time</h2><div class="chart-sub">${snaps[0].feed_total?.toLocaleString()||'—'} → ${snaps[snaps.length-1].feed_total?.toLocaleString()||'—'} · ${snaps.length} snapshots</div><div class="chart">${bars}</div><div class="chart-axis"><span>${snaps[0].date}</span><span>${snaps[snaps.length-1].date}</span></div></div>`;
  }
  $('#charts').innerHTML=todayHtml+longHtml;

  // Grid3: Topics / KG / GPU
  const merged={};
  for(const [k,v] of Object.entries(topics)){
    const c=k.toLowerCase().replace(/\s+/g,' ').trim();
    merged[c]=(merged[c]||0)+v;
  }
  const tl=Object.entries(merged).sort((a,b)=>b[1]-a[1]).slice(0,8);
  const tmx=Math.max(...tl.map(e=>e[1]),1);
  const topicsHtml=tl.map(([t,n])=>{
    const s=t.length>25?t.substring(0,23)+'…':t;
    return `<div class="topic-row"><span class="topic-name" title="${t}">${s}</span><div class="tbg"><div class="tbf" style="width:${Math.max(n/tmx*100,4)}%"></div></div><span class="tc">${n}</span></div>`;
  }).join('');

  let kgHtml=Row('Entities',fmt(kg.entities||0),'c-accent')+Row('Relations',fmt(kg.relations||0),'c-blue')+Row('Associations',fmt(kg.associations||0),'c-purple');
  kgHtml+=`<div style="margin-top:8px;border-top:1px solid var(--border);padding-top:8px;">${Row('RAG Vectors','913+','c-ok')}${Row('Corpus','27 transcripts + 59 lessons','c-dim')}</div>`;

  const gpu=d.gpu_stats||{};
  let gpuHtml='';
  if(gpu.gpu_name)gpuHtml+=Row('GPU',gpu.gpu_name,'c-accent');
  if(gpu.temp_c!=null)gpuHtml+=Row('Temp',gpu.temp_c+'°C',gpu.temp_c>80?'c-warn':gpu.temp_c>70?'c-orange':'c-ok');
  if(gpu.gpu_util_pct!=null)gpuHtml+=Row('Util',gpu.gpu_util_pct+'%',gpu.gpu_util_pct>80?'c-orange':'c-blue');
  if(gpu.power_w!=null)gpuHtml+=Row('Power',gpu.power_w+'W','');
  gpuHtml+=`<div style="margin-top:8px;border-top:1px solid var(--border);padding-top:8px;">${Row('qwen3-32b','32B · ~64GB','c-dim')}${Row('qwen3-8b','8B · ~16GB','c-dim')}${Row('nomic-embed','RAG embeddings','c-dim')}</div>`;

  $('#grid3').innerHTML=`
    <div class="card"><h2>Research Topics</h2>${topicsHtml}</div>
    <div class="card"><h2>Knowledge Graph</h2>${kgHtml}</div>
    <div class="card"><h2>DGX Spark · GB10</h2>${gpuHtml}</div>`;

  // Jobs
  const rc=(d.cycles||[]).slice(-4).reverse();
  let jHtml='';
  for(const cyc of rc){
    const t=new Date(cyc.ts);
    const hhmm=t.toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true});
    jHtml+=`<div class="cycle-hdr"><span class="c-lbl">Cycle ${cyc.cycle||'?'}</span><span class="c-time">${hhmm}</span><span class="c-grew">+${cyc.feed_grew||cyc.feed_growth||0}</span></div>`;
    for(const j of (cyc.jobs||[])){
      const st=j.status||'—';
      jHtml+=`<div class="job-row ${st}"><span class="jn">${j.name||'—'}</span><span class="jm">${j.duration?dur(j.duration):''} ${(j.grew||0)>0?'<span class="c-ok">+'+j.grew+'</span>':''}</span><span class="js ${st}">${st}</span></div>`;
    }
  }
  if(!rc.some(c=>(c.jobs||[]).length)){
    jHtml=(d.recent_jobs||[]).filter(j=>j.name).slice(0,10).map(j=>{
      const st=j.status||'—';
      return `<div class="job-row ${st}"><span class="jn">${j.name}</span><span class="jm">${j.duration?dur(j.duration):''} ${(j.grew||0)>0?'<span class="c-ok">+'+j.grew+'</span>':''}</span><span class="js ${st}">${st}</span></div>`;
    }).join('');
  }
  $('#jobs').innerHTML='<h2>Recent Cycles</h2>'+jHtml;

  // Research
  const entries=(f.last_entries||[]).slice(-6).reverse();
  const feedHtml=entries.filter(e=>typeof e==='object').map(e=>{
    const ts=e.timestamp?new Date(e.timestamp).toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit',hour12:true}):'';
    return `<div class="feed-item"><span class="feed-topic">${e.topic||''}</span><span class="feed-time">${ts}</span><div class="feed-finding">${(e.finding||e.insight||'').substring(0,230)}</div></div>`;
  }).join('');
  $('#research').innerHTML='<h2>Latest Research</h2>'+(feedHtml||'<div style="color:var(--text3);font-size:12px;">No entries yet</div>');
}

render();
setInterval(render,30000);
</script>
</body></html>
