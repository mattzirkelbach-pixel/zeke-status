<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zeke ‚Äî Mission Control</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #08090d;
  --surface: rgba(255,255,255,0.025);
  --glass: rgba(255,255,255,0.04);
  --border: rgba(255,255,255,0.06);
  --border-h: rgba(255,255,255,0.12);
  --text: rgba(255,255,255,0.9);
  --t2: rgba(255,255,255,0.5);
  --t3: rgba(255,255,255,0.25);
  --cyan: #22d3ee;
  --cyan-g: rgba(34,211,238,0.15);
  --green: #34d399;
  --green-g: rgba(52,211,153,0.12);
  --amber: #fbbf24;
  --amber-g: rgba(251,191,36,0.12);
  --red: #f87171;
  --red-g: rgba(248,113,113,0.12);
  --purple: #a78bfa;
  --blue: #60a5fa;
  --r: 16px;
  --head: 'Outfit', sans-serif;
  --mono: 'JetBrains Mono', monospace;
}
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:var(--head);background:var(--bg);color:var(--text);min-height:100vh;overflow-x:hidden;-webkit-font-smoothing:antialiased}
body::before{content:'';position:fixed;top:0;left:0;right:0;bottom:0;background:
  radial-gradient(ellipse 80% 50% at 20% 20%, rgba(34,211,238,0.04) 0%, transparent 50%),
  radial-gradient(ellipse 60% 40% at 80% 80%, rgba(167,139,250,0.04) 0%, transparent 50%),
  radial-gradient(ellipse 50% 60% at 50% 50%, rgba(52,211,153,0.02) 0%, transparent 50%);
  pointer-events:none;z-index:0}
.wrap{max-width:1440px;margin:0 auto;padding:20px 24px;position:relative;z-index:1}

/* Header */
.hdr{display:flex;justify-content:space-between;align-items:center;padding:12px 0 28px}
.logo{display:flex;align-items:center;gap:14px}
.logo-mark{width:36px;height:36px;border-radius:10px;background:linear-gradient(135deg,var(--cyan),var(--purple));display:flex;align-items:center;justify-content:center;font-family:var(--mono);font-weight:700;font-size:16px;color:#000;box-shadow:0 0 20px rgba(34,211,238,0.2)}
.logo-text{font-size:22px;font-weight:600;letter-spacing:-0.02em}
.logo-sub{font-family:var(--mono);font-size:10px;color:var(--t3);letter-spacing:0.08em;text-transform:uppercase;margin-top:2px}
.hdr-right{display:flex;align-items:center;gap:16px}
.status-pill{display:flex;align-items:center;gap:8px;padding:6px 16px;border-radius:20px;background:var(--glass);border:1px solid var(--border);font-family:var(--mono);font-size:11px;color:var(--t2);backdrop-filter:blur(12px)}
.status-dot{width:7px;height:7px;border-radius:50%;animation:pulse 2s ease-in-out infinite}
@keyframes pulse{0%,100%{opacity:1;box-shadow:0 0 4px currentColor}50%{opacity:.4;box-shadow:none}}
.status-ts{font-family:var(--mono);font-size:10px;color:var(--t3)}

/* Grid */
.grid{display:grid;grid-template-columns:320px 1fr 1fr;grid-template-rows:auto;gap:14px}
@media(max-width:1200px){.grid{grid-template-columns:1fr 1fr}}
@media(max-width:700px){.grid{grid-template-columns:1fr}}
.span2{grid-column:span 2}
.span3{grid-column:span 3}
@media(max-width:1200px){.span2,.span3{grid-column:span 2}}
@media(max-width:700px){.span2,.span3{grid-column:span 1}}

/* Cards */
.card{background:var(--glass);backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px);border:1px solid var(--border);border-radius:var(--r);padding:20px;transition:border-color .3s,transform .25s,box-shadow .3s;position:relative;overflow:hidden}
.card:hover{border-color:var(--border-h);transform:translateY(-2px);box-shadow:0 8px 32px rgba(0,0,0,0.3)}
.card::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;background:linear-gradient(90deg,transparent 10%,rgba(255,255,255,0.06) 50%,transparent 90%)}
.card-label{font-family:var(--mono);font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:0.12em;color:var(--t3);margin-bottom:14px;display:flex;align-items:center;gap:7px}
.card-label .dot{width:5px;height:5px;border-radius:50%}

/* Autonomy Ring */
.autonomy{grid-row:span 2;display:flex;flex-direction:column;align-items:center;padding:24px 20px}
.ring-wrap{position:relative;width:220px;height:220px;margin:8px 0 20px}
.ring-svg{width:100%;height:100%;transform:rotate(-90deg)}
.ring-bg{fill:none;stroke:rgba(255,255,255,0.04);stroke-width:7}
.ring-fg{fill:none;stroke-width:7;stroke-linecap:round;transition:stroke-dashoffset 2s cubic-bezier(.4,0,.2,1)}
.ring-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center}
.ring-pct{font-family:var(--mono);font-size:44px;font-weight:700;letter-spacing:-0.03em;background:linear-gradient(135deg,var(--cyan),var(--purple));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.ring-label{font-size:11px;color:var(--t2);margin-top:4px}
.milestones{width:100%;margin-top:8px}
.ms{display:flex;align-items:center;gap:10px;padding:7px 0;border-bottom:1px solid var(--border)}
.ms:last-child{border:none}
.ms-check{width:18px;height:18px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:9px;flex-shrink:0;transition:all .3s}
.ms-done{background:var(--green-g);color:var(--green);border:1.5px solid rgba(52,211,153,0.4)}
.ms-active{background:var(--cyan-g);color:var(--cyan);border:1.5px solid rgba(34,211,238,0.4);animation:pulse 2s ease-in-out infinite}
.ms-pending{background:var(--surface);color:var(--t3);border:1.5px solid var(--border)}
.ms-info{flex:1}
.ms-name{font-size:12px;font-weight:500}
.ms-sub{font-size:10px;color:var(--t3);margin-top:1px}
.ms-score{font-family:var(--mono);font-size:10px;color:var(--t3)}

/* Big metric */
.metric{font-family:var(--mono);font-weight:700;font-size:38px;letter-spacing:-0.03em;line-height:1}
.metric-sm{font-family:var(--mono);font-weight:600;font-size:24px;line-height:1}
.metric-label{font-size:11px;color:var(--t3);margin-top:4px}
.metric-row{display:flex;gap:24px;flex-wrap:wrap}
.metric-item{min-width:56px}
.metric-delta{font-family:var(--mono);font-size:11px;margin-left:6px;vertical-align:middle}
.delta-up{color:var(--green)}
.delta-down{color:var(--red)}

/* Sparkline */
.spark-wrap{height:48px;margin-top:12px;position:relative;cursor:crosshair}
.spark-wrap canvas{width:100%;height:100%;display:block}
.spark-tip{position:absolute;padding:4px 8px;background:rgba(0,0,0,0.9);border:1px solid var(--border-h);border-radius:6px;font-family:var(--mono);font-size:10px;color:var(--cyan);pointer-events:none;opacity:0;transition:opacity .12s;white-space:nowrap;z-index:10;top:-26px}

/* GPU Gauge */
.gauge-wrap{display:flex;align-items:center;gap:20px}
.gauge-ring{width:92px;height:92px;position:relative;flex-shrink:0}
.gauge-ring svg{width:100%;height:100%}
.gauge-center{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-family:var(--mono);font-weight:700;font-size:20px}
.gauge-stats{flex:1}
.gauge-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid var(--border);font-family:var(--mono);font-size:11px}
.gauge-row:last-child{border:none}
.gauge-row span:first-child{color:var(--t3)}

/* Pipeline */
.pipeline{display:flex;align-items:stretch;justify-content:center;gap:0;padding:8px 0;flex-wrap:wrap}
.pipe-node{display:flex;flex-direction:column;align-items:center;justify-content:center;gap:5px;padding:14px 18px;border-radius:14px;border:1.5px solid;transition:all .3s;position:relative;min-width:100px;cursor:default}
.pipe-node:hover{transform:scale(1.06);z-index:2}
.pipe-icon{font-size:20px}
.pipe-name{font-family:var(--mono);font-size:10px;font-weight:600;letter-spacing:0.05em}
.pipe-sub{font-family:var(--mono);font-size:9px;opacity:.5}
.pipe-model{font-family:var(--mono);font-size:8px;opacity:.4;margin-top:2px}
.pipe-ok{border-color:rgba(52,211,153,0.35);background:var(--green-g);color:var(--green)}
.pipe-active{border-color:rgba(34,211,238,0.35);background:var(--cyan-g);color:var(--cyan)}
.pipe-off{border-color:var(--border);background:var(--surface);color:var(--t3)}
.pipe-arrow{font-size:18px;color:var(--t3);padding:0 6px;display:flex;align-items:center}

/* Domain bars */
.dom-row{display:flex;align-items:center;gap:10px;margin:5px 0;cursor:default;padding:2px 0;border-radius:4px;transition:background .2s}
.dom-row:hover{background:rgba(255,255,255,0.02)}
.dom-name{font-family:var(--mono);font-size:10px;color:var(--t3);width:100px;text-align:right;flex-shrink:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;transition:color .2s}
.dom-bar-outer{flex:1;height:10px;background:rgba(255,255,255,0.03);border-radius:5px;overflow:hidden;position:relative}
.dom-fill{height:100%;border-radius:5px;transition:width 1s cubic-bezier(.4,0,.2,1)}
.dom-val{font-family:var(--mono);font-size:10px;color:var(--t3);width:28px;text-align:right;transition:color .2s}
.dom-row:hover .dom-name,.dom-row:hover .dom-val{color:var(--text)}

/* Quality grid */
.quality-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-top:10px}
.q-item{text-align:center;padding:10px 6px;border-radius:10px;background:var(--surface);transition:transform .2s}
.q-item:hover{transform:scale(1.05)}
.q-val{font-family:var(--mono);font-size:18px;font-weight:600}
.q-label{font-size:9px;color:var(--t3);margin-top:3px}

/* Job list */
.job-row{display:flex;align-items:center;gap:8px;padding:6px 4px;border-bottom:1px solid var(--border);font-family:var(--mono);font-size:10px;transition:background .2s;border-radius:4px;cursor:default}
.job-row:last-child{border:none}
.job-row:hover{background:rgba(255,255,255,0.02)}
.job-dot{width:7px;height:7px;border-radius:50%;flex-shrink:0}
.job-name{color:var(--t2);flex:1;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.job-time{color:var(--t3);width:52px;text-align:right;font-size:9px}
.job-dur{color:var(--t3);width:40px;text-align:right}

/* System info */
.sys-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px 16px}
.sys-item{font-family:var(--mono);font-size:10px;color:var(--t3);line-height:1.7;display:flex;justify-content:space-between}
.sys-item span:last-child{color:var(--t2)}

/* Self-heal log */
.log-area{font-family:var(--mono);font-size:10px;color:var(--t3);line-height:1.6;max-height:120px;overflow-y:auto;white-space:pre-wrap;word-break:break-word;padding:10px;background:rgba(0,0,0,0.35);border-radius:10px;border:1px solid var(--border)}
.log-area::-webkit-scrollbar{width:4px}
.log-area::-webkit-scrollbar-thumb{background:var(--border-h);border-radius:2px}

/* Cost badge */
.cost-badge{display:inline-flex;align-items:center;gap:4px;padding:3px 10px;border-radius:12px;font-family:var(--mono);font-size:11px;font-weight:600}
.cost-free{background:var(--green-g);color:var(--green);border:1px solid rgba(52,211,153,0.3)}

/* Animate in */
@keyframes fadeUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
.card{animation:fadeUp .6s ease-out both}
.card:nth-child(1){animation-delay:.05s}.card:nth-child(2){animation-delay:.1s}
.card:nth-child(3){animation-delay:.15s}.card:nth-child(4){animation-delay:.2s}
.card:nth-child(5){animation-delay:.25s}.card:nth-child(6){animation-delay:.3s}
.card:nth-child(7){animation-delay:.35s}.card:nth-child(8){animation-delay:.4s}
.card:nth-child(9){animation-delay:.45s}.card:nth-child(10){animation-delay:.5s}

/* Glow on autonomy card */
.autonomy{overflow:visible}
.autonomy::before{content:'';position:absolute;top:-40px;left:-40px;right:-40px;bottom:-40px;background:radial-gradient(ellipse at center,rgba(34,211,238,0.04),transparent 70%);pointer-events:none;border-radius:30px}
</style>
</head>
<body>
<div class="wrap">
  <div class="hdr">
    <div class="logo">
      <div class="logo-mark">Z</div>
      <div><div class="logo-text">Zeke</div><div class="logo-sub">mission control</div></div>
    </div>
    <div class="hdr-right">
      <div class="cost-badge cost-free">$0/day</div>
      <div class="status-pill"><div class="status-dot" id="sd"></div><span id="sh">loading</span></div>
      <div class="status-ts" id="sts"></div>
    </div>
  </div>
  <div class="grid" id="grid"></div>
</div>

<script>
const DATA_URL = "status.json";
const HIST_URL = "history.jsonl";

let S = {}, H = [], prevFeed = null;

async function load() {
  try {
    const [a, b] = await Promise.allSettled([
      fetch(DATA_URL + "?_=" + Date.now()).then(r => r.json()),
      fetch(HIST_URL + "?_=" + Date.now()).then(r => r.text())
    ]);
    if (a.status === 'fulfilled') S = a.value;
    if (b.status === 'fulfilled') {
      H = b.value.trim().split("\n").filter(Boolean).map(l => {
        try { return JSON.parse(l) } catch { return null }
      }).filter(Boolean);
    }
  } catch (e) { console.error(e) }
  render();
}

function ago(ts) {
  if (!ts) return "‚Äî";
  const s = (Date.now() - new Date(ts).getTime()) / 1000;
  if (s < 60) return Math.round(s) + "s ago";
  if (s < 3600) return Math.round(s / 60) + "m ago";
  if (s < 86400) return Math.round(s / 3600) + "h ago";
  return Math.round(s / 86400) + "d ago";
}

function esc(s) { return String(s || "").replace(/&/g, "&amp;").replace(/</g, "&lt;") }

function sparkline(cv, data, color, tipEl) {
  if (!data || data.length < 2) return;
  const c = cv.getContext("2d"), dpr = devicePixelRatio || 1;
  const w = cv.offsetWidth, h = cv.offsetHeight;
  cv.width = w * dpr; cv.height = h * dpr; c.scale(dpr, dpr);
  const mx = Math.max(...data), mn = Math.min(...data), rng = mx - mn || 1;
  const pad = 4, step = w / (data.length - 1);

  // Fill gradient
  const grad = c.createLinearGradient(0, 0, 0, h);
  const base = color.match(/[\d.]+/g);
  if (base && base.length >= 3) {
    grad.addColorStop(0, `rgba(${base[0]},${base[1]},${base[2]},0.18)`);
    grad.addColorStop(1, `rgba(${base[0]},${base[1]},${base[2]},0)`);
  }

  // Line
  c.beginPath();
  data.forEach((v, i) => {
    const x = i * step, y = pad + ((mx - v) / rng) * (h - pad * 2);
    i === 0 ? c.moveTo(x, y) : c.lineTo(x, y);
  });
  c.strokeStyle = color; c.lineWidth = 1.8; c.stroke();

  // Fill
  c.lineTo((data.length - 1) * step, h); c.lineTo(0, h); c.closePath();
  c.fillStyle = grad; c.fill();

  // End dot
  const lastY = pad + ((mx - data[data.length - 1]) / rng) * (h - pad * 2);
  c.beginPath(); c.arc((data.length - 1) * step, lastY, 3, 0, Math.PI * 2);
  c.fillStyle = color; c.fill();

  // Hover tooltip
  if (tipEl) {
    cv.onmousemove = e => {
      const rect = cv.getBoundingClientRect();
      const x = e.clientX - rect.left;
      const idx = Math.min(Math.max(Math.round(x / step), 0), data.length - 1);
      tipEl.style.opacity = '1';
      tipEl.style.left = Math.min(Math.max(x - 20, 0), w - 60) + 'px';
      tipEl.textContent = data[idx];
    };
    cv.onmouseleave = () => { tipEl.style.opacity = '0' };
  }
}

function parseKG(s) {
  const r = {}; if (!s) return r;
  let m = s.match(/Entities: (\d+)/); if (m) r.ent = +m[1];
  m = s.match(/Relationships: (\d+)/); if (m) r.rel = +m[1];
  m = s.match(/Associations: (\d+)/); if (m) r.assoc = +m[1];
  m = s.match(/Insights: (\d+)/); if (m) r.ins = +m[1];
  const dm = s.match(/Domains: (\{[\s\S]*\})/);
  if (dm) try { r.dom = JSON.parse(dm[1]) } catch {}
  return r;
}

function calcAutonomy(kg, fq, gw, sp, cs) {
  let stages = [];

  // 1. Gather: gateway + spark + feed growing
  const gatherOk = gw.status === "RUNNING" && sp.status === "ONLINE";
  const gatherScore = gatherOk ? 20 : (gw.status === "RUNNING" ? 10 : 0);
  stages.push({ name: "Gather", sub: "Autonomous web research", model: "qwen3-32b", done: gatherOk, score: gatherScore });

  // 2. Extract: KG > 50 entities
  const extractOk = (kg.ent || 0) > 50;
  const extractScore = extractOk ? 20 : Math.min(20, Math.round(((kg.ent || 0) / 50) * 20));
  stages.push({ name: "Extract", sub: "Knowledge graph construction", model: "qwen3-32b", done: extractOk, score: extractScore });

  // 3. Associate: meaningful cross-domain links
  const assocRatio = (kg.ent || 0) > 0 ? ((kg.assoc || 0) / (kg.ent || 1)) : 0;
  const assocOk = assocRatio > 0.15 && (kg.assoc || 0) > 10;
  const assocScore = assocOk ? 20 : Math.min(20, Math.round(assocRatio * 100));
  stages.push({ name: "Associate", sub: "Cross-domain connections", model: "qwen3-32b", done: assocOk, score: assocScore });

  // 4. Reason: Claude Code synthesis active
  const reasonOk = cs.has_reason === true;
  const reasonScore = reasonOk ? 20 : 0;
  stages.push({ name: "Reason", sub: "Deep synthesis & planning", model: "Claude Code", done: reasonOk, score: reasonScore });

  // 5. Act: insights generated + self-heal
  const actOk = (kg.ins || 0) > 0;
  const actScore = actOk ? 20 : 0;
  stages.push({ name: "Act", sub: "Autonomous decisions & action", model: "‚Äî", done: actOk, score: actScore });

  const totalScore = stages.reduce((s, st) => s + st.score, 0);
  return { score: Math.min(totalScore, 100), stages };
}

function render() {
  const gw = S.gateway_process || {}, gpu = S.gpu_stats || {}, sp = S.spark_status || {};
  const fq = S.feed_quality || {}, cs = S.crontab_status || {}, kg = parseKG(S.kg_stats);
  const jobs = S.last_jobs || [];

  const on = gw.status === "RUNNING" && sp.status === "ONLINE";
  const fails = jobs.filter(j => j.result === "FAILED").length;
  const health = !on ? "offline" : fails > jobs.length / 2 ? "degraded" : "nominal";

  const sd = document.getElementById("sd");
  sd.style.background = health === "nominal" ? "var(--green)" : health === "degraded" ? "var(--amber)" : "var(--red)";
  sd.style.color = sd.style.background;
  document.getElementById("sh").textContent = health;
  document.getElementById("sts").textContent = ago(S.timestamp);

  const auto = calcAutonomy(kg, fq, gw, sp, cs);
  const fH = H.map(h => h.feed_lines).filter(v => v != null);
  const kH = H.map(h => h.kg_entities).filter(v => v != null);
  const eH = H.map(h => h.feed_error_rate).filter(v => v != null);

  const feedDelta = prevFeed !== null ? (S.feed_lines || 0) - prevFeed : null;
  prevFeed = S.feed_lines || 0;

  const dc = ["#22d3ee", "#34d399", "#fbbf24", "#a78bfa", "#60a5fa", "#fb923c", "#f87171", "#e879f9"];
  const doms = kg.dom || {};
  const mxD = Math.max(...Object.values(doms), 1);
  const pJ = jobs.filter(j => j.result === "SUCCESS").length;
  const fJ = jobs.filter(j => j.result === "FAILED").length;

  const circ = 2 * Math.PI * 96;
  const autoOffset = circ - (auto.score / 100) * circ;
  const gpuUtil = gpu.gpu_util_pct || 0;
  const gpuC = 2 * Math.PI * 36;
  const gpuOff = gpuC - (gpuUtil / 100) * gpuC;
  const gpuColor = gpuUtil > 50 ? "var(--green)" : gpuUtil > 5 ? "var(--amber)" : "var(--t3)";

  const firstPending = auto.stages.findIndex(s => !s.done);

  const g = document.getElementById("grid");
  g.innerHTML = `
    <!-- AUTONOMY -->
    <div class="card autonomy">
      <div class="card-label"><div class="dot" style="background:var(--cyan)"></div>Recursive Autonomy</div>
      <div class="ring-wrap">
        <svg class="ring-svg" viewBox="0 0 210 210" style="transform:rotate(-90deg)">
          <circle cx="105" cy="105" r="96" fill="none" stroke="rgba(255,255,255,0.035)" stroke-width="7"/>
          <circle cx="105" cy="105" r="96" fill="none" stroke="url(#ag)" stroke-width="7" stroke-linecap="round"
            stroke-dasharray="${circ}" stroke-dashoffset="${autoOffset}" style="transition:stroke-dashoffset 2s cubic-bezier(.4,0,.2,1)"/>
          <defs><linearGradient id="ag" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" stop-color="var(--cyan)"/><stop offset="100%" stop-color="var(--purple)"/>
          </linearGradient></defs>
        </svg>
        <div class="ring-center">
          <div class="ring-pct">${auto.score}%</div>
          <div class="ring-label">toward full autonomy</div>
        </div>
      </div>
      <div class="milestones">
        ${auto.stages.map((st, i) => `
          <div class="ms">
            <div class="ms-check ${st.done ? 'ms-done' : i === firstPending ? 'ms-active' : 'ms-pending'}">${st.done ? '‚úì' : i === firstPending ? '‚ñ∏' : '‚óã'}</div>
            <div class="ms-info">
              <div class="ms-name" style="color:${st.done ? 'var(--green)' : i === firstPending ? 'var(--cyan)' : 'var(--t3)'}">${st.name}</div>
              <div class="ms-sub">${st.sub}</div>
            </div>
            <div class="ms-score">${st.score}/20</div>
          </div>`).join('')}
      </div>
    </div>

    <!-- FEED -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:var(--cyan)"></div>Research Feed</div>
      <div style="display:flex;align-items:baseline;gap:4px">
        <div class="metric" style="color:var(--cyan)">${S.feed_lines || 0}</div>
        ${feedDelta !== null && feedDelta > 0 ? `<span class="metric-delta delta-up">+${feedDelta}</span>` : ''}
      </div>
      <div class="metric-label">entries ¬∑ ${(fq.error_rate || 0).toFixed(1)}% error rate</div>
      <div class="spark-wrap"><canvas id="cf"></canvas><div class="spark-tip" id="cft"></div></div>
    </div>

    <!-- KG -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:var(--blue)"></div>Knowledge Graph</div>
      <div class="metric-row">
        <div class="metric-item"><div class="metric" style="color:var(--blue)">${kg.ent || 0}</div><div class="metric-label">entities</div></div>
        <div class="metric-item"><div class="metric-sm">${kg.rel || 0}</div><div class="metric-label">relations</div></div>
        <div class="metric-item"><div class="metric-sm">${kg.assoc || 0}</div><div class="metric-label">links</div></div>
        <div class="metric-item"><div class="metric-sm" style="color:${(kg.ins || 0) > 0 ? 'var(--green)' : 'var(--t3)'}">${kg.ins || 0}</div><div class="metric-label">insights</div></div>
      </div>
      <div class="spark-wrap"><canvas id="ck"></canvas><div class="spark-tip" id="ckt"></div></div>
    </div>

    <!-- GPU -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:${gpuColor}"></div>DGX Spark ¬∑ ${esc(gpu.gpu_name || 'GPU')}</div>
      <div class="gauge-wrap">
        <div class="gauge-ring">
          <svg viewBox="0 0 80 80">
            <circle cx="40" cy="40" r="36" fill="none" stroke="rgba(255,255,255,0.035)" stroke-width="5"/>
            <circle cx="40" cy="40" r="36" fill="none" stroke="${gpuColor}" stroke-width="5" stroke-linecap="round"
              stroke-dasharray="${gpuC}" stroke-dashoffset="${gpuOff}" transform="rotate(-90 40 40)" style="transition:stroke-dashoffset 1s"/>
          </svg>
          <div class="gauge-center" style="color:${gpuColor}">${Math.round(gpuUtil)}%</div>
        </div>
        <div class="gauge-stats">
          <div class="gauge-row"><span>temp</span><span>${gpu.temp_c != null ? gpu.temp_c + '¬∞C' : '‚Äî'}</span></div>
          <div class="gauge-row"><span>power</span><span>${gpu.power_w != null ? Math.round(gpu.power_w) + 'W' : '‚Äî'}</span></div>
          <div class="gauge-row"><span>model</span><span style="font-size:9px">${(sp.loaded_models || []).map(m => m.name).join(', ') || 'idle'}</span></div>
          <div class="gauge-row"><span>vram</span><span>${(sp.loaded_models || []).map(m => m.size_gb + 'GB').join(', ') || '‚Äî'}</span></div>
        </div>
      </div>
    </div>

    <!-- PIPELINE -->
    <div class="card span2">
      <div class="card-label"><div class="dot" style="background:var(--purple)"></div>Pipeline</div>
      <div class="pipeline">
        ${auto.stages.map((st, i) => `
          <div class="pipe-node ${st.done ? 'pipe-ok' : i === firstPending ? 'pipe-active' : 'pipe-off'}">
            <div class="pipe-icon">${['üîç', '‚õèÔ∏è', 'üîó', 'üß†', '‚ö°'][i]}</div>
            <div class="pipe-name">${st.name}</div>
            <div class="pipe-sub">${st.score}/20</div>
            <div class="pipe-model">${st.model}</div>
          </div>
          ${i < 4 ? '<div class="pipe-arrow">‚Üí</div>' : ''}`).join('')}
      </div>
    </div>

    <!-- DOMAINS -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:var(--purple)"></div>Knowledge Domains</div>
      ${Object.entries(doms).sort((a, b) => b[1] - a[1]).map(([n, ct], i) => `
        <div class="dom-row">
          <div class="dom-name">${esc(n)}</div>
          <div class="dom-bar-outer"><div class="dom-fill" style="width:${Math.round(ct / mxD * 100)}%;background:${dc[i % dc.length]}"></div></div>
          <div class="dom-val">${ct}</div>
        </div>`).join('') || '<div style="font-size:11px;color:var(--t3)">no domain data</div>'}
    </div>

    <!-- FEED QUALITY -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:${(fq.error_rate || 0) > 15 ? 'var(--red)' : (fq.error_rate || 0) > 5 ? 'var(--amber)' : 'var(--green)'}"></div>Feed Quality</div>
      <div class="quality-grid">
        <div class="q-item"><div class="q-val" style="color:var(--red)">${fq.malformed_json || 0}</div><div class="q-label">bad json</div></div>
        <div class="q-item"><div class="q-val" style="color:var(--amber)">${fq.literal_timestamps || 0}</div><div class="q-label">bad time</div></div>
        <div class="q-item"><div class="q-val" style="color:var(--purple)">${fq.duplicates || 0}</div><div class="q-label">dupes</div></div>
        <div class="q-item"><div class="q-val" style="color:var(--t3)">${fq.no_new_dev || 0}</div><div class="q-label">no-ops</div></div>
      </div>
      <div class="spark-wrap"><canvas id="ce"></canvas><div class="spark-tip" id="cet"></div></div>
    </div>

    <!-- RECENT JOBS -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:var(--green)"></div>Recent Jobs</div>
      <div class="metric-row" style="margin-bottom:10px">
        <div class="metric-item"><div class="metric-sm" style="color:var(--green)">${pJ}</div><div class="metric-label">passed</div></div>
        <div class="metric-item"><div class="metric-sm" style="color:var(--red)">${fJ}</div><div class="metric-label">failed</div></div>
      </div>
      ${jobs.slice(-8).reverse().map(j => `
        <div class="job-row">
          <div class="job-dot" style="background:${j.result === 'FAILED' ? 'var(--red)' : j.result === 'SUCCESS' ? 'var(--green)' : 'var(--t3)'}"></div>
          <div class="job-name">${esc(j.topic || 'unknown')}</div>
          <div class="job-time">${esc(j.time || '')}</div>
          <div class="job-dur">${j.duration_s ? j.duration_s + 's' : '‚Äî'}</div>
        </div>`).join('')}
    </div>

    <!-- SELF-HEAL -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:var(--amber)"></div>Self-Heal Log</div>
      <div class="log-area">${esc(S.self_heal_log || '').slice(0, 1200) || 'no issues logged'}</div>
    </div>

    <!-- SYSTEM -->
    <div class="card">
      <div class="card-label"><div class="dot" style="background:var(--t3)"></div>System</div>
      <div class="sys-grid">
        <div class="sys-item"><span>gateway</span><span>${gw.status || '?'}</span></div>
        <div class="sys-item"><span>pid</span><span>${gw.pid || '?'}</span></div>
        <div class="sys-item"><span>memory</span><span>${gw.memory_pct || '?'}%</span></div>
        <div class="sys-item"><span>uptime</span><span>${gw.uptime || '?'}</span></div>
        <div class="sys-item"><span>spark</span><span>${sp.status || '?'}</span></div>
        <div class="sys-item"><span>cron active</span><span>${cs.active || 0}</span></div>
        <div class="sys-item"><span>overnight</span><span>${cs.has_overnight ? '‚úì' : '‚úó'}</span></div>
        <div class="sys-item"><span>reasoning</span><span>${cs.has_reason ? '‚úì' : '‚úó'}</span></div>
        <div class="sys-item"><span>queue</span><span>${cs.has_queue ? '‚úì' : '‚úó'}</span></div>
        <div class="sys-item"><span>cost</span><span style="color:var(--green)">$0/day</span></div>
      </div>
    </div>
  `;

  // Draw sparklines
  setTimeout(() => {
    const pairs = [['cf', 'cft', fH, 'rgb(34,211,238)'], ['ck', 'ckt', kH, 'rgb(96,165,250)'], ['ce', 'cet', eH, 'rgb(248,113,113)']];
    pairs.forEach(([cid, tid, data, color]) => {
      const cv = document.getElementById(cid), tip = document.getElementById(tid);
      if (cv && data.length > 1) sparkline(cv, data, color, tip);
    });
  }, 100);
}

load();
setInterval(load, 60000);
</script>
</body>
</html>
